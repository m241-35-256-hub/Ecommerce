<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Cart</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="css/style.css">
    <!-- Cart Utilities -->
    <script src="js/cart-utils.js"></script>
</head>

<body>
    <div class="container">
        <header>
            <div class="nav container">
                <a href="#" class="logo">
                    <img src="images/logo.png" alt="">
                </a>
                <div class="navbar">
                    <a href="index.html" class="nav-link">Home</a>
                    <a href="index.html#items" class="nav-link">Featured Items</a>
                    <a href="index.html#menu-container" class="nav-link">Menu</a>
                    <a href="index.html#testimonials" class="nav-link">Testimonials</a>
                    <a href="index.html" class="nav-link">Blog</a>
                </div>
                <div class="nav-icons">
                    <a href="#"><i class='bx bxs-user-circle'></i></a>
                    <a href="mycart.html" class="cart"><i class='bx bxs-cart-alt'></i>
                        <span id="cart-total">0</span></a>

                    <div class="menu-icon">
                        <div class="line1"></div>
                        <div class="line2"></div>
                        <div class="line3"></div>
                    </div>
                </div>
            </div>
        </header>
        <section>
            <div class="row">
                <div>
                    <br>
                    <br>
                </div>
                <div class="col-lg-12 text-center border rounded bg-light my-5">
                    <h1>My Cart</h1>
                </div>
                <div class="col-lg-9">
                    <table class="table table-striped text-center">
                        <thead>
                            <tr>
                                <th scope="col">Serial No.</th>
                                <th scope="col">Product Name</th>
                                <th scope="col">Spicy Level</th>
                                <th scope="col">Unit Price</th>
                                <th scope="col">Quantity</th>
                                <th scope="col">Total</th>
                                <th scope="col"></th>
                            </tr>
                        </thead>
                        <tbody class="text-center" id="cart-items">
                            <!-- Cart items will be loaded from localStorage via JavaScript -->
                        </tbody>
                    </table>
                </div>

                <div class="col-lg-3">
                    <div class="border bg-light rounded p-4">
                        <h4>Grand Total:</h4>
                        <h5 class="text-end" id="gtotal">0</h5>
                        <br>
                        <div id="checkout-form-container"></div>
                    </div>
                </div>
            </div>
        </section>
    </div>

<script>
    // Load cart from localStorage
    function loadCartFromLocalStorage() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const cartItemsContainer = document.getElementById('cart-items');
        const checkoutFormContainer = document.getElementById('checkout-form-container');
        const cartTotal = document.getElementById('cart-total');
        
        // Update cart count
        cartTotal.innerText = cart.length;
        
        // Clear existing items
        cartItemsContainer.innerHTML = '';
        
        if (cart.length === 0) {
            cartItemsContainer.innerHTML = '<tr><td colspan="7" class="text-center">Your cart is empty</td></tr>';
            checkoutFormContainer.innerHTML = '';
            return;
        }
        
        // Populate cart items
        cart.forEach((item, index) => {
            const sr = index + 1;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${sr}</td>
                <td>${item.Product_name}</td>
                <td>${item.Spicy_level}</td>
                <td>$${item.Price}<input type='hidden' class='iprice' value='${item.Price}'></td>
                <td>
                    <input class='text-center iquantity' type='number' value='${item.Quantity}' min='1' max='10' 
                           onchange='updateQuantity("${item.Product_name}", this.value)'>
                </td>
                <td class='itotal'></td>
                <td>
                    <div class='d-grid gap-2 col-6 mx-auto'>    
                        <button class='btn btn-danger btn-sm remove-btn' onclick='removeItemFromCart("${item.Product_name}")'>REMOVE</button>
                    </div>
                </td>
            `;
            cartItemsContainer.appendChild(row);
        });
        
        // Show checkout form if cart has items
        checkoutFormContainer.innerHTML = `
            <form id="checkout-form" onsubmit="return handleCheckout(event)" class="form-floating">
                <div class="mb-3">
                    <label>Full Name</label>
                    <input type="text" name="full_name" class="form-control" placeholder="e.g: John Doe" required>
                </div>
                <div class="mb-3">
                    <label>Phone Number</label>
                    <input type="tel" name="phone_no" class="form-control" placeholder="e.g: +1234567890" required>
                </div>
                <div class="mb-3">
                    <label for="address" class="form-label">Enter your Address:</label>
                    <input type="text" name="address" class="form-control" required>
                </div>
                
                <br>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="pay_mode" value="COD" id="cod" checked>
                    <label class="form-check-label" for="cod">
                        Cash on Delivery
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="pay_mode" value="Online" id="online" disabled>
                    <label class="form-check-label" for="online">
                        Online Payment (Coming Soon)
                    </label>
                </div>
                <br>
                <div class="d-grid gap-2 col-7 mx-auto">
                    <button class="btn btn-primary" type="submit">Make Purchase</button>
                </div>
            </form>
        `;
        
        // Calculate totals
        subTotal();
    }
    
    // Update quantity in localStorage
    function updateQuantity(productName, newQuantity) {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        const itemIndex = cart.findIndex(item => item.Product_name === productName);
        
        if (itemIndex !== -1) {
            cart[itemIndex].Quantity = newQuantity;
            localStorage.setItem('cart', JSON.stringify(cart));
            subTotal();
        }
    }
    
    // Remove item from localStorage
    function removeItemFromCart(productName) {
        if (confirm('Are you sure you want to remove this item?')) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            cart = cart.filter(item => item.Product_name !== productName);
            localStorage.setItem('cart', JSON.stringify(cart));
            loadCartFromLocalStorage();
        }
    }

    // Calculate subtotal
    var gt = 0;
    function subTotal() {
        gt = 0;
        var iprice = document.getElementsByClassName('iprice');
        var iquantity = document.getElementsByClassName('iquantity');
        var itotal = document.getElementsByClassName('itotal');
        var gtotal = document.getElementById('gtotal');
        
        for (i = 0; i < iprice.length; i++) {
            itotal[i].innerText = '$' + (iprice[i].value * iquantity[i].value).toFixed(2);
            gt = gt + (iprice[i].value * iquantity[i].value);
        }
        gtotal.innerText = '$' + gt.toFixed(2);
    }

    // Handle checkout
    function handleCheckout(event) {
        event.preventDefault();
        
        const form = event.target;
        const formData = new FormData(form);
        
        const orderData = {
            customer: {
                name: formData.get('full_name'),
                phone: formData.get('phone_no'),
                address: formData.get('address')
            },
            paymentMode: formData.get('pay_mode'),
            items: JSON.parse(localStorage.getItem('cart')) || [],
            total: gt,
            orderDate: new Date().toISOString(),
            orderId: 'ORD-' + Date.now()
        };
        
        // Save order to localStorage
        const orders = JSON.parse(localStorage.getItem('orders') || '[]');
        orders.push(orderData);
        localStorage.setItem('orders', JSON.stringify(orders));
        
        // Clear cart
        localStorage.removeItem('cart');
        
        // Show success message
        alert(`Order Placed Successfully!\n\nOrder ID: ${orderData.orderId}\nTotal: $${orderData.total.toFixed(2)}\n\nThank you for your order!`);
        
        // Redirect to home page
        window.location.href = 'index.html';
        
        return false;
    }

    // Load cart on page load
    window.addEventListener('DOMContentLoaded', () => {
        loadCartFromLocalStorage();
    });
</script>
</body>

</html>
